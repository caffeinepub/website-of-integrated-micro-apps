{
  "kind": "build_request",
  "title": "Stage 2: CI Pipeline Configuration and Verification",
  "projectName": "Arkly Portal",
  "priority": "high",
  "requirements": [
    {
      "id": "REQ-51",
      "text": "Create a GitHub Actions workflow file at .github/workflows/ci.yml that runs the test suite on push to main branch and on pull requests. The workflow must include jobs to: (1) start a local dfx replica in the CI environment, (2) deploy the backend canister, (3) install frontend test dependencies (vitest, @vitest/ui, @testing-library/react, @testing-library/jest-dom, happy-dom), (4) run the test suite with 'npm test', and (5) upload test results as artifacts.",
      "target": "both",
      "source": {
        "messageIds": [
          "msg-user-stage2"
        ],
        "quotes": [
          "begin building Stage 2 immediately"
        ]
      },
      "acceptanceCriteria": [
        "Workflow file exists at .github/workflows/ci.yml",
        "Workflow triggers on push to main and on pull requests",
        "Job starts dfx replica successfully in CI environment",
        "Job deploys backend canister before running tests",
        "Job installs all required test dependencies",
        "Job executes 'npm test' command",
        "Test results are uploaded as workflow artifacts"
      ]
    },
    {
      "id": "REQ-52",
      "text": "Configure the CI workflow to use dfx 0.15.0 or newer and Node.js 18.x or newer. Include steps to cache dfx installation and npm dependencies to speed up CI runs. Add a step to generate and upload a test coverage report if coverage tooling is available.",
      "target": "both",
      "source": {
        "messageIds": [
          "msg-user-stage2"
        ],
        "quotes": [
          "begin building Stage 2 immediately"
        ]
      },
      "acceptanceCriteria": [
        "CI workflow specifies dfx version 0.15.0 or newer",
        "CI workflow specifies Node.js version 18.x or newer",
        "Workflow includes caching step for dfx installation",
        "Workflow includes caching step for npm dependencies",
        "If vitest coverage is configured, workflow generates coverage report",
        "Coverage report is uploaded as workflow artifact if generated"
      ]
    },
    {
      "id": "REQ-53",
      "text": "Add a CI status badge to the project README.md (or create README.md if it does not exist) that displays the current CI pipeline status from GitHub Actions. Include a brief section explaining how to run tests locally and a link to the test suite documentation at frontend/src/__tests__/README.md.",
      "target": "both",
      "source": {
        "messageIds": [
          "msg-user-stage2"
        ],
        "quotes": [
          "begin building Stage 2 immediately"
        ]
      },
      "acceptanceCriteria": [
        "README.md file exists at project root",
        "README includes GitHub Actions CI status badge",
        "README includes section on running tests locally",
        "README includes link to frontend/src/__tests__/README.md",
        "Status badge displays correct workflow status"
      ]
    },
    {
      "id": "REQ-54",
      "text": "Update frontend/src/__tests__/README.md to include a new 'Continuous Integration' section that explains: (1) which CI platform is configured (GitHub Actions), (2) when tests run automatically (on push to main, on pull requests), (3) where to view CI results (GitHub Actions tab), and (4) how to troubleshoot CI failures by running the same commands locally.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-user-stage2"
        ],
        "quotes": [
          "begin building Stage 2 immediately"
        ]
      },
      "acceptanceCriteria": [
        "Frontend test README includes 'Continuous Integration' section",
        "Section documents GitHub Actions as the CI platform",
        "Section explains automatic test triggers",
        "Section provides location for viewing CI results",
        "Section includes troubleshooting guidance with local command examples"
      ]
    },
    {
      "id": "REQ-55",
      "text": "Verify that the CI pipeline executes successfully on GitHub by pushing the workflow configuration to the repository and confirming that all test jobs complete without errors. Document any environment-specific adjustments needed for the CI environment in the workflow file comments.",
      "target": "both",
      "source": {
        "messageIds": [
          "msg-user-stage2"
        ],
        "quotes": [
          "begin building Stage 2 immediately"
        ]
      },
      "acceptanceCriteria": [
        "Workflow successfully starts dfx replica in CI",
        "Workflow successfully deploys backend canister",
        "Workflow successfully installs dependencies",
        "Workflow successfully runs test suite",
        "All test jobs complete without errors",
        "Workflow file includes comments documenting CI-specific configuration"
      ]
    }
  ],
  "constraints": [
    "Must use GitHub Actions as the CI platform",
    "Must use dfx 0.15.0 or newer",
    "Must use Node.js 18.x or newer",
    "Must not modify existing test files in frontend/src/__tests__/",
    "CI workflow must run on both push to main and pull requests"
  ],
  "nonGoals": [
    "Setting up CI for deployment to production",
    "Configuring code quality or linting checks in CI",
    "Adding security scanning or dependency audits",
    "Creating multiple CI workflows for different environments",
    "Implementing CD (Continuous Deployment) pipeline"
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}